<!DOCTYPE HTML>
<html lang="">

<head>
    <meta charset="UTF-8" />
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <title>Physical-Cyber-Social Model</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="" />
    <meta name="HandheldFriendly" content="true" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />

    <link rel="icon" type="image/png" sizes="96x96" href="assets/graphics/exports/PCS_logo_fav.png">

    <link rel="stylesheet" href="assets/style.css">
</head>

<script src="libs/d3.min.js"></script>
<script src="libs/jquery-3.1.1.min.js"></script>

<script src="libs/socket.io.min.js"></script>

<script data-main="PCSmodel" src="libs/require.js"></script>

<span class="pcs-logo">
    <img src="assets/graphics/exports/PCS_logo.png" /><span class="pcs-logo-text">Physical-Cyber-Social Model</span>
</span>


<!-- Devices Graph -->
<script src="scripts/graph.js"></script>
<style>
    .node {
        stroke: #fff;
        stroke-width: 1.5px;
        z-index: 10;
    }
    
    .link {
        stroke: #999;
        stroke-opacity: .6;
    }
</style>

<div id="thegraph" class="userDeviceProximityGraph">
</div>


<!-- Google Maps -->
<div id="googleMap"></div>

<script src="https://maps.googleapis.com/maps/api/js"></script>
<script>
    // Subscribe the GPS coordinates from the model
    $('#googleMap').hide();

    function updatedLocation(lat, long) {
        var myCenter = new google.maps.LatLng(lat, long);

        function initialize() {
            var mapProp = {
                center: myCenter,
                zoom: 15,
                scrollwheel: false,
                draggable: false,
                disableDefaultUI: true,

                mapTypeId: google.maps.MapTypeId.ROADMAP
            };

            var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

            var marker = new google.maps.Marker({
                position: myCenter,
            });

            marker.setMap(map);
        }

        initialize();
    };



    // Wait for a little while for the pcs to get initialized
    var currentLocationMD5 = '';
    setTimeout(function () {

        pcsModel.addCallbackForEvent('location', function (event) {
            if (currentLocationMD5 !== event.md5 &&
                pcsModel.model.location.latitude && pcsModel.model.location.longitude) {

                log('old: ' + currentLocationMD5 + ' vs. ' + event.md5);
                currentLocationMD5 = event.md5;


                $('#googleMap').fadeIn();

                updatedLocation(
                    pcsModel.model.location.latitude,
                    pcsModel.model.location.longitude
                );

            } else {

                $('#googleMap').fadeOut(5000);
            }
        });

        pcsModel.addCallbackForEvent('social_proximity_set', function (event) {

        });

    }, 1000);
</script>


<script>
    setTimeout(function () {
        log('ProximityGraph');

        var event = {
            graph: {
                nodes: {}
            }
        };

        updateProximityGraph('nikkis', 'iphone');

    }, 1000);
</script>

</html>